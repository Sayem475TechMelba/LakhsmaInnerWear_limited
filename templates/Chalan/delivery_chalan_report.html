{% extends "index.html" %}
{% load static %}
{% load widget_tweaks %}
{% block title %} Lakshma | Delivery Chalan Report {% endblock title %}
{% block homeactive  %}active{% endblock homeactive  %}

{% block css %}
<style>
   
    tfoot {
      display:table-header-group;
    }
</style>
{% endblock css %}

{% block body %}


<div class="container-fluid search-box">
  <div class="d-flex">
    <div class="mr-auto p-2">
      <a type="button" href="{% url 'deliveryChalan' %}" class="btn btn-sm btn-info gr"><i class="fa fa-plus" aria-hidden="true"></i> Add Chalan</a>
    </div>
    <div class="p-2">
      <a  type="btn" class="btn btn-sm btn-light " onClick="javascript:history.go(-1);"><i class="fa fa-undo" aria-hidden="true"></i></a>
    </div>
  </div>
  <div class="text-center mt-2 font-weight-bold"><h5>Delivery Challan</h5></div>
    <div class="card   ">
        <div class=" search text-center">
          <form method="GET" class="p-1" action="{% url 'delivery_chalan_report' %}">
            <div class="">
              <table  class="table table-sm table-bordered table-responsive  table-responsive-sm ">
                <thead class="bg-meroon">
                  <tr>
                    <th>Factory Name</th>
                    <th>Chalan No.</th>
                    <th>Invoice No.</th>
                    <th>Job No.</th>
                    <th>Buyer Name</th>
                    <th>Driver Name</th>
                    <th>Ship Mode</th>
                    <th>Port Name</th>
                    <th>Start Date</th>
                    <th>End Date </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{ myFilter.form.factory_name|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.chalan_no|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.invoice_no|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.job_no|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.buyer_name|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.driver_name|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.shipmode|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.port_name|attr:"class:form-control"}}</td>
                    <td>{{ myFilter.form.start_date|attr:"type:date"|attr:"class:form-control" }}</td>
                    <td>{{ myFilter.form.end_date|attr:"type:date"|attr:"class:form-control" }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="container justify-content-center align-content-center text-center">
              <button type="submit" class="btn btn-sm btn-success"><i class="fa fa-search mr-2" aria-hidden="true"></i> Search</button>
              <a href="{% url 'delivery_chalan_report' %}" type="button" class="btn btn-sm btn-danger ml-1"><i class="fa fa-times mr-2" aria-hidden="true"></i> Reset</a>
            </div>
          </form>
        </div>
        <div class="container ">
          <div class="d-flex justify-content-center table-responsive">
            <div class="p-2">
              <table class="mb-1 table-sm  table-responsive-sm ">
                <thead>
                    <td width="20%">
                      <select id="getYear" onChange="copyTextValue()" class="form-control">
                        <option value="" disabled selected>Select</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                      </select>
                    </td>
                    <td><button type="" class="btn btn-sm btn-info ml-2 " >Jan</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Feb</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Mar</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Apr</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">May</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Jun</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Jul</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Aug</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Sep</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Oct</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2" onclick="myFunction()"  id="getMonth">Nov</button></td>
                    <td><button type="" class="btn btn-sm btn-info ml-2">Dec</button></td>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
</div>

  {% if  '/delivery_chalan_report/?' in request.get_full_path %}
  <div class="container-fluid">
      <!-- /.card-header -->
      <div class="card-body table-responsive ">
        <table id="challan_report" class="table table-hover   table-bordered table-striped  table-sm display">
          <thead class=' bg-info'>
            <tr>
              <th>SL.</th>
              <th>Factory Name</th>
              <th>Job No.</th>
              <th>Order No.</th>
              <th>Buyer Name</th>
              <th>Challan No.</th>
              <th>Invoice No.</th>
              <th>Ship Qty</th>
              <th>Ship Carton Qty</th>
              <th>Total CBM</th>
              <th>Ship Mode</th>
              <th>Delivery Date </th>
              <th>Port Name </th>
              <th>Driver Name </th>
              <th>Action </th>
            </tr>
          </thead>
          <tfoot id="chalanSearch">
            <tr>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th></th>
             <th ></th>
             <th></th>
             <th></th>
             <th></th>
            </tr>
          </tfoot>
          <tbody>
            {% for i in chalan %}
            <tr>

              <td>{{forloop.counter}}</td>
              <td>{{i.factory_name}}</td>
              <td>{{i.job_no}}</td>
              <td>
                {% for ft in i.sh_inline.all %}
                {{ft.order_no}}/
                {% endfor %}
              </td>

              <td>{{i.buyer_name}}</td>
              <td>{{i.chalan_no}}</td>
              <td>{{i.invoice_no}}</td>

              <td>{{i.total_good_qty}}</td>
              <td>{{i.total_cartoon_qty}}</td>
              <td>{{i.total_cbm}}</td>
              <td>{{i.shipmode}}</td>
              <td>{{i.chalan_date}}</td>
              <td >{{i.port_name}}</td>
              <td >{{i.driver_name}}</td>
              
              <td>
                <div class="btn-group">
                  <button type="button" class="btn btn-danger btn-sm" data-toggle="dropdown">Action</button>
                  <button type="button" class="btn btn-danger btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  </button>
                  <div class="dropdown-menu  dropdown-menu-right">
                    <a class="dropdown-item" href="{% url 'viewChalan' i.id %}"><i class="fas fa-eye text-info  mr-2" data-toggle="tooltip" data-placement="bottom" title="View"></i> View</a>

                    <a class="dropdown-item" href="{% url 'editChalan' i.id  %}"><i class="fas fa-pencil-alt text-warning mr-2" data-toggle="tooltip" data-placement="bottom" title="Update"></i> Edit</a>

                    <a class="dropdown-item" href="{% url 'print_Challan' i.id  %}"><i class="fas fa-print text-warning mr-2" data-toggle="tooltip" data-placement="bottom" title="Print"></i> Print Delivery Challan</a>

                    <a class="dropdown-item" href="{% url 'delete_Challan' i.id  %}" onclick="return confirm('Are you sure you want to delete this item?')"><i class="fas fa-trash text-danger  mr-2 " data-toggle="tooltip" data-placement="bottom" title="Delete"></i> Delete</a>

                  </div>
                </div>
                
              </td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot >
            <tr>
             <th colspan="7" class="text-right font-weight-bolder">Total:</th>
             <th id="shipqty" class="bg-yel"></th>
             <th id="shipCart_qty" class="bg-yel"></th>
             <th id="total_CBM" class="bg-yel"></th>
             <th colspan="5" ></th>

             
            </tr>
          </tfoot>
        
        </table>
      </div>
  </div>
  {% endif %}


{% endblock body %}

{% block script %}

<script type="text/javascript">
  $(document).ready(function() {
    // Setup - add a text input to each footer cell
    $('#challan_report #chalanSearch th').each( function () {
        var title = $(this).text();
        $(this).html( '<input type="text" class="form-control"  placeholder="Search" />' );
    } );
   
    // DataTable
    var table = $('#challan_report').DataTable({
      drawCallback: function(){
        const shipqty = this.api().column(7,{search:'applied'}).data().toArray().reduce((total,shipqty) => total+=Number(shipqty.replace(/[^0-9\.]/g,'')),0);
        $('#shipqty').text(` ${(shipqty)}`);

        const shipCart_qty = this.api().column(8,{search:'applied'}).data().toArray().reduce((total,shipCart_qty) => total+=Number(shipCart_qty.replace(/[^0-9\.]/g,'')),0);
        $('#shipCart_qty').text(` ${(shipCart_qty)}`);

        const total_CBM = this.api().column(9,{search:'applied'}).data().toArray().reduce((total,total_CBM) => total+=Number(total_CBM.replace(/[^0-9\.]/g,'')),0);
        $('#total_CBM').text(` ${(total_CBM)}`);
      },

      "lengthMenu": [[500,1000,-1], [500,1000,"All"]],
      "scrollY": 470,
      "scrollX": true,
        initComplete: function () {
            // Apply the search
            this.api().columns().every( function () {
                var that = this;
                $( 'input', this.footer() ).on( 'keyup change clear ', function () {
                    if ( that.search() !== this.value ) {
                        that
                            .search( this.value )
                            .draw();
                    }
                } );
            } );
        }
    });
 
} );
</script>

<script>
  function myFunction() {
    document.getElementById("getDate").value = "Nov";
  }
</script>

<script>
  function copyTextValue() {
    var text1 = document.getElementById("getYear").value;
    var x = document.getElementById("getDate").value = text1+' ';
    document.getElementById("helloId").value = x;
  }
</script>

  

{% endblock script %}

