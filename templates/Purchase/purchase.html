{% extends "index.html" %}
{% load widget_tweaks %}
{% load static %}
{% block title %} Lakshma | Purchase Form To Bank {% endblock title %}
{% block homeactive  %}active{% endblock homeactive  %}

{% block css %}
<style>
    .bg-white{
        background-color: white;
    }
    .p-30{
        padding:40px;
    }
</style>
{% endblock css %}

{% block body %}


<div class="container">
    <div class="">{% include 'Index/alerts.html' %}</div>
    <div class="d-flex">
      <div class="mr-auto p-2">
        <a type="button" href="{% url 'purchase_report' %}" class="btn btn-sm btn-info gr"><i class="fa fa-bars" aria-hidden="true"></i> Purchase Report</a>
      </div>
      <div class="p-2">
        <a  type="btn" class="btn btn-sm btn-light " onClick="javascript:history.go(-1);"><i class="fa fa-undo" aria-hidden="true"></i></a>
      </div>
    </div>
  
    
    <div class=" card border border-light">
      <div class=" p-2 bg-form-header">
          <h5 class="text-uppercase text-center ">Export Bill Purchase</h4>
      </div>
      <div class="container p-4 bg-form">
          <div class="row">
              <div class="col-md-12 P-4">
              
                  <form method="post" enctype="multipart/form-data">
                      {% csrf_token %}
                      <div class="form-group row ">
                          <label for="job_no" class="col-sm-2 col-form-label ">Job No.</label>
                          <div class="col-sm-2 ">
                            {{ form.job_no|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Job No."}}
                          </div>
                          <label for="order_no" class="col-sm-2 col-form-label ">Order No.</label>
                          <div class="col-sm-2 ">
                            {{ form.order_no|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Order No."}}
                          </div>
                          <label for="l_ref_no" class="col-sm-2 col-form-label label">Laksma Reff. No.</label>
                          <div class="col-sm-2 ">
                            {{ form.l_ref_no|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Lakhsma Ref No."|attr:"required" }}
                          </div>
                        </div>
                        <div class="form-group row ">
                          <label for="inv_no" class="col-sm-2 col-form-label label">INV NO.</label>
                          <div class="col-sm-2 ">
                            {{ form.inv_no|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Invoice No."|attr:"required" }}
                          </div>
                          <label for="inv_no" class="col-sm-2 col-form-label label">Buyer Name</label>
                          <div class="col-sm-2 ">
                            {{ form.buyer_name|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Buyer Name"|attr:"required" }}
                          </div>
                          <label for="factory_name" class="col-sm-2 col-form-label label">Factory Name</label>
                          <div class="col-sm-2 ">
                            {{ form.factory_name|attr:"class:form-control"|attr:"type:text"|attr:"required" }}
                          </div>
                        </div>
                        <div class="form-group row ">
                          <label for="p_date" class="col-sm-2 col-form-label ">Date</label>
                          <div class="col-sm-2 ">
                            {{ form.p_date|attr:"class:form-control"|attr:"type:date"|attr:"required" }}
                          </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-bordered table-hover table-sm" >
                                <thead class="bg-table-header">
                                    <tr>
                                        <th class="text-center label"  width="20%">Bank Name </th>
                                        <th class="text-center label"  width="30%">Branch </th>
                                        <th class="text-center"  width="40%"> Address </th>
                                    </tr>
                                </thead>
                                <tbody >
                                    <tr >
                                        <td >
                                            {{ form.bank_name|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Bank Name"|attr:"required"|attr:"onchange:fetcher()" }}
                                        </td>
                                        <td >
                                            
                                            {{ form.bank_branch|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Bank Branch"|attr:"required"|attr:"onchange:addressFetcher()" }}
                                        </td>
                                        <td >
                                            
                                            {{ form.bank_address|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Bank Address"|attr:"required" }}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-bordered table-hover table-sm" >
                                <thead class="bg-table-header">
                                    <tr>
                                        <th class="text-center label"> Bill Value </th>
                                        <th class="text-center label">Bill Refference No. </th>
                                        <th class="text-center"> Bill Date </th>
                                        <th class="text-center" width="150px"> Choose SC/LC  </th>
                                        <th class="text-center"> SC/LC No. </th>
                                        <th class="text-center"> SC/LC Date  </th>
                                        <th class="text-center"> SC/LC Value ($) </th>
                                    </tr>
                                </thead>
                                <tbody >
                                    <tr >
                                        <td >
                                            {{ form.bill_value|attr:"class:form-control"|attr:"type:number"|attr:"placeholder: Bill No"|attr:"id:bill_value"|attr:"required" }}
                                        </td>
                                        <td >
                                            {{ form.bill_no|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Bill Reff No."|attr:"id:bill_no"|attr:"required" }}
                                        </td>
                                        <td >
                                            {{ form.bill_date|attr:"class:form-control"|attr:"type:date"|attr:"id:bill_date"|attr:"required" }}
                                        </td>
                                        <td >
                                            {{ form.choose_sc_or_lc|attr:"class:form-control"|attr:"id:Choose_sc_or_lc"|attr:"required" }}
                                        </td>
                                        <td >
                                            {{ form.sc_or_lc_no|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:SC/LC No"|attr:"id:sc_or_lc_no"|attr:"required" }}
                                        </td>
                                        <td >
                                            {{ form.sc_or_lc_date|attr:"class:form-control"|attr:"type:date"|attr:"id:sc_or_lc_date"|attr:"required" }}
                                        </td>
                                        <td >
                                            {{ form.sc_or_lc_amount|attr:"class:form-control"|attr:"type:number"|attr:"placeholder:Price ($)"|attr:"id:sc_or_lc_amount"|attr:"required" }}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="form-group row ">
                            <label for="total_btb_amount" class="col-sm-2 col-form-label label">Total BTB Amount ($)</label>
                            <div class="col-sm-2 ">
                                {{ form.total_btb_amount|attr:"class:form-control"|attr:"type:number"|attr:"placeholder:BTB Amount"|attr:"id:total_btb_amount"|attr:"required" }}
                            </div>
                            <label for="tenor" class="col-sm-2 col-form-label label">Tenor</label>
                            <div class="col-sm-2 ">
                                {{ form.tenor|attr:"class:form-control"|attr:"type:text"|attr:"placeholder:Tenor"|attr:"id:tenor"|attr:"required" }}
                            </div>
                            <label for="export_bill" class="col-sm-2 col-form-label label">Export Bill Amount ($)</label>
                            <div class="col-sm-2 ">
                                {{ form.export_bill|attr:"class:form-control"|attr:"type:number"|attr:"placeholder:Export Bill"|attr:"id:export_bill"|attr:"required"|attr:"oninput=calc();"|attr:"readonly" }}
                            </div>
                        </div>
  
                        <!-- SECTION 6 - Calculation  -->
                        <div class="invoice-items mt-2">
                            <div class="table-responsive" style="overflow: hidden; outline: none;" tabindex="0">
                                <table class="table table-bordered table-sm">
                                    <thead class="bg-table-header">
                                        <tr>
                                            <th class="per70 text-center">Action</th>
                                            <th class="per70 text-center">Particulars</th>
                                            <th class="per70 text-center">Percentage (%)</th>
                                            <th class="per70 text-center">Amount ($)</th>
                                        </tr>
                                    </thead>
                                    <tbody >
                                  
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="bill" disabled onchange="adjustment('export_bill_check')" name='export_bill_check' id='export_bill_check' aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.export_bill_amount|attr:"class:form-control"|attr:"type:text"|attr:"id:export_bill_amount"|attr:"value:Export Bill Amount"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.export_bill_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:export_bill_pct"|attr:"required"|attr:"readonly" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.export_bill_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:export_bill_amt"|attr:"required"|attr:"oninput=calc();"|attr:"name:export_bill_amt"|attr:"readonly" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="lc" onclick="adjustment('btb_lc_check')" id="btb_lc_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.btb_lc|attr:"class:form-control"|attr:"type:text"|attr:"id:btb_lc"|attr:"value:Less. BTB L/C"|attr:"required" }}
                                                <!-- <input type="text" name="btb_lc" class="form-control" id="btb_lc" value="Less. BTB L/C value" required > -->
                                            </td>
                                            <td class="text-center">
                                                {{ form.btb_lc_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:btb_lc_pct"|attr:"required"|attr:"oninput=calc();"}}
                                                <!-- <input type="text" name="btb_lc_pct" class="form-control" id="btb_lc_pct" value="0.00" required > -->
                                            </td>
                                            <td class="text-center">
                                                {{ form.btb_lc_amt|attr:"class:form-control"|attr:"type:number"|attr:"required"|attr:"oninput=calc();"|attr:"id:btb_lc_amt"|attr:"name:btb_lc_amt"  }}
                                                <!-- <input type="text" name="btb_lc_amt" class="form-control" id="btb_lc_amt" placeholder="0.00" required > -->
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="pc" onchange="adjustment('pc_amount_check')" name="pc_amount_check" id="pc_amount_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.pc_amount|attr:"class:form-control"|attr:"type:text"|attr:"value:Less. PC Amount"|attr:"id:pc_amount"|attr:"value:Export Bill Amount"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.pc_amount_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:pc_amount_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.pc_amount_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:pc_amount_amt"|attr:"required"|attr:"oninput=calc();"| attr:"name:pc_amount_amt" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="snd" onchange="adjustment('snd_amount_check')" name='snd_amount_check' id="snd_amount_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.snd_amount|attr:"class:form-control"|attr:"type:text"|attr:"value:Less. SND Amount"|attr:"id:snd_amount"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.snd_amount_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:snd_amount_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.snd_amount_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:snd_amount_amt"|attr:"required"|attr:"name:snd_amount_amt"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="term" onchange="adjustment('term_loan_check')" name="term_loan_check" id="term_loan_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.term_loan|attr:"class:form-control"|attr:"type:text"|attr:"value:Less. Term Loan"|attr:"id:term_loan"|attr:"required" }}
                                            </td>
                                            
                                            <td class="text-center">
                                                {{ form.term_loan_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:term_loan_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.term_loan_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:term_loan_amt"|attr:"name:term_loan_amt"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="time" onchange="adjustment('time_load_check')" name="time_load_check" id="time_load_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.time_loan|attr:"class:form-control"|attr:"type:text"|attr:"value:Less. Time Loan"|attr:"id:time_loan"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.time_loan_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:time_loan_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.time_loan_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:time_loan_amt"|attr:"name:time_loan_amt"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="od" onchange="adjustment('od_load_check')" name="od_load_check" id="od_load_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.od_loan|attr:"class:form-control"|attr:"type:text"|attr:"value:Less. OD Loan"|attr:"id:od_loan"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.od_loan_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:od_loan_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.od_loan_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:od_loan_amt"|attr:"name:od_loan_amt"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="edf" onchange="adjustment('edf_interest_check')" name="edf_interest_check" id="edf_interest_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.edf_interest|attr:"class:form-control"|attr:"type:text"|attr:"value:Less. EDF Interest"|attr:"id:edf_interest"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.edf_interest_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:edf_interest_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.edf_interest_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:edf_interest_amt"|attr:"name:edf_interest_amt"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="buying"  onchange="adjustment('buying_com_check')" name='buying_com_check' id='buying_com_check' aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.buying_com|attr:"class:form-control"|attr:"type:text"|attr:"value:Less. Buying Comm."|attr:"id:buying_com"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.buying_com_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:buying_com_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.buying_com_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:buying_com_amt"|attr:"name:buying_com_amt"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="tax" onchange="adjustment('tax_other_check')" name="tax_other_check" id="tax_other_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.tax_other|attr:"class:form-control"|attr:"type:text"|attr:"value:Source Tax & others:"|attr:"id:tax_other"|attr:"required" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.tax_other_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:tax_other_pct"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.tax_other_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:tax_other_amt"|attr:"name:tax_other_amt"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:5%">
                                                <div class="input-group-text" width="300">
                                                    <input type="checkbox" name="" onchange="adjustment('additional_one_check')" name="additional_one_check" id="additional_one_check" aria-label="Checkbox for following text input">
                                                  </div>
                                            </td>
                                            <td>
                                                {{ form.additional_one|attr:"class:form-control"|attr:"type:text"|attr:"id:additional_one"|attr:"name:additional_one" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.additional_one_pct|attr:"class:form-control"|attr:"type:number"|attr:"id:additional_one_pct"|attr:"oninput=calc();" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.additional_one_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:additional_one_amt"|attr:"name:additional_one_amt"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                     
                                       
                                        <tr>
                                            <td colspan="2">TOTAL COST ($)</td>
                                            <td class="text-center">  
                                                {{ form.total_percentage|attr:"class:form-control"|attr:"type:number"|attr:"id:total_percentage"|attr:"required"|attr:"oninput=calc();"|attr:"readonly" }}
                                            </td>
                                            <td class="text-center">
                                                {{ form.total_amount|attr:"class:form-control"|attr:"type:number"|attr:"id:total_amount"|attr:"required"|attr:"oninput=calc();"|attr:"readonly" }}
                                            </td>
                                        </tr>

                                        <tr class="text-center font-weight-bold">
                                            <td colspan="2">Net Amount($) :</td>
                                            <td> Balance </td>
                                            <td>
                                                {{ form.net_amount|attr:"class:form-control"|attr:"type:number"|attr:"id:net_amount"|attr:"required"|attr:"oninput=calc();"|attr:"readonly" }}
                                            </td>
                                        </tr>
                                        
                                    </tbody>

                                    <tbody class=" font-weight-bold">
                                        <tr>
                                            <td colspan="3" >
                                                <div class="form-group row">
                                                    <label for="staticEmail" class="col-sm-2 col-form-label">Adjustment of</label>
                                                    <div class="col-sm-10">
                                                    {{ form.liability_adj|attr:"class:form-control"|attr:"type:text"|attr:"id:checkout_names"|attr:"oninput=calc();"|attr:"readonly" }}
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="text-center">
                                                {{ form.liability_adj_value|attr:"class:form-control"|attr:"type:number"|attr:"id:ad_tpc"|attr:"required"|attr:"oninput=calc();" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="text-right">Total Purchase</td>
                                            <td class="text-center">
                                                {{ form.total_purchase|attr:"class:form-control"|attr:"type:number"|attr:"id:total_purchase"|attr:"required"|attr:"oninput=calc();"|attr:"readonly" }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="text-right">Approve Net Amount</td>
                                            <td class="text-center">
                                                {{ form.approve_net_amt|attr:"class:form-control"|attr:"type:number"|attr:"id:approve_net_amt"|attr:"required"|attr:"oninput=calc();"|attr:"readonly"  }}
                                                
                                            </td>
                                        </tr>
                                         <tr>
                                            <td colspan="3" class="text-danger text-right">Due Amount</td>
                                            <td class="text-center">
                                                {{ form.due_amt|attr:"class:form-control border-danger bg-danger"|attr:"type:number"|attr:"id:due_amt"|attr:"required"|attr:"oninput=calc();"|attr:"readonly" }}
                                               
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="text-right">Payment Status</td>
                                            <td class="text-center">
                                                {{ form.payment_status|attr:"class:form-control"|attr:"id:payment_status"|attr:"oninput=calc();"|attr:"disabled" }}
                                                
                                            </td>

                                        </tr>
                                       
                                        <tr>
                                            <td colspan="3" class="text-right">Approve Date</td>
                                            <td class="text-center">
                                                {{ form.approval_date|attr:"class:form-control readonly"|attr:"type:date"|attr:"id:bill_date"|attr:"readonly" }}
                                            </td>
                                            
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                       

                        <div class="row mt-2">
                            <div class="col-md-6 col-lg-6">
                                <button type="submit" class="btn btn-success btn-sm">Submit</button>
                            
                            </div>
                            <div class="col-md-6 col-lg-6 text-right">
                                <input  onclick="demoShow()" type="button" value="Show Data" class="btn btn-warning btn-sm">
                            </div>
                       </div>
                  </form>
                </div>
  
              </div>
          </div>
  
    </div>
  </div>

  <div class="container-fluid mt-3 " style="visibility: hidden;" id="show">
    <div class="table-responsive ">
     <table  class="table table-bordered table-striped table-sm display table-hover mb-5">
       <thead>
         <tr>
           <th colspan="9"></th>
           <th colspan="9" class="bg-secondary"> <h5  class="text-center font-weight-bold">Liability Adustment </h5></th>
           <th colspan="5" ></th>
         </tr>

         <tr>
           <th class="text-center">SL.</th>
           <th class="text-center">Factory Name</th>
           <th class="text-center">Job No.</th>
           <th class="text-center" >Order No.</th>
           <th class="text-center">Buyer Name</th>
           <th class="text-center">Purchase No.</th>
           <th class="text-center" >Purchase Date</th>
           <th class="text-center">Bill No</th>
           <th class="text-center" >Bill Amount</th>

           <th class="bg-danger text-center">BTB</th>
           <th class="bg-danger text-center"> PC </th>
           <th  class="bg-danger text-center" >SND</th>
           <th  class="bg-danger text-center">Term </th>
           <th class="bg-danger text-center">Time </th>
           <th class="bg-danger text-center">OD </th>
           <th class="bg-danger text-center">EDF </th>
           <th class="bg-danger text-center"> Com.</th>
           <th class="bg-danger text-center">Tax </th>
           <th class="text-center bg-success" >CM Requested</th>
           <th class="text-center bg-success" >Approve CM</th>
           <th class=" bg-danger">Due</th>
            <th class="text-center" >Payment Status</th>
           <th class="text-center">Action </th>
         </tr>
       </thead>

     
       <tbody>
         {% for i in purchase_list %}
         <tr>
           <td>{{forloop.counter}}</td>
           <td>{{i.factory_name}}</td>
           <td>{{i.job_no}}</td>
           <td>{{i.order_no}}</td>
           <td>{{i.buyer_name}}</td>
           <td>{{i.purchase_no}}</td>
           <td>{{i.bill_date}}</td>
           <td>{{i.bill_no}}</td>
           <td class="billamount">{{i.net_amount|floatformat:2}}</td>

           <td class="btb_lc_amt">{{i.btb_lc_amt|floatformat:2}}</td>
           <td class="pc_amount_amt">{{i.pc_amount_amt|floatformat:2}}</td>
           <td class="snd_amount_amt" >{{i.snd_amount_amt|floatformat:2}}</td>
           <td class="term_loan_amt">{{i.term_loan_amt|floatformat:2}}</td>
           <td class="time_loan_amt">{{i.time_loan_amt|floatformat:2}}</td>
           <td class="od_loan_amt">{{i.od_loan_amt|floatformat:2}}</td>
           <td class="edf_interest_amt">{{i.edf_interest_amt|floatformat:2}}</td>
           <td class="buying_com_amt">{{i.buying_com_amt|floatformat:2}}</td>
           <td class="tax_other_amt">{{i.tax_other_amt|floatformat:2}}</td>
           <td class="req_cm">{{i.net_amount|floatformat:2}}</td>
           <td class="app_cm" >{{i.approve_net_amt|floatformat:2}}</td>
           <td class="due_amt">{{i.due_amt|floatformat:2}}</td>
           <td >{{i.payment_status}}</td>
           <td>
             <div class="btn-group">
               <button type="button" class="btn btn-danger btn-sm" data-toggle="dropdown">Action</button>
               <button type="button" class="btn btn-danger btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
               </button>
               <div class="dropdown-menu">
                <a class="dropdown-item" href="{% url 'view_purchase' i.id %}"><i class="fas fa-eye text-info  mr-2" data-toggle="tooltip" data-placement="bottom" title="View"></i> View</a>
                <a class="dropdown-item" href="{% url 'update_purchase' i.id %}"><i class="fas fa-pencil-alt text-warning mr-2" data-toggle="tooltip" data-placement="bottom" title="Update"></i> Edit</a>
                <a class="dropdown-item" href="{% url 'print_purchase' i.id %}"><i class="fas fa-print text-warning mr-2" data-toggle="tooltip" data-placement="bottom" title="Print"></i> Print Purchase Form</a>
                <a class="dropdown-item" href="{% url 'delete_purchase' i.id %}" onclick="return confirm('Are you sure you want to delete this item?')"><i class="fas fa-trash text-danger  mr-2 " data-toggle="tooltip" data-placement="bottom" title="Delete"></i> Delete</a>
              </div>
              
             </div>
           </td>
         </tr>
         
         {% endfor %}
       </tbody>
       
     </table>
   </div>
 </div>

  

{% endblock body %}

{% block script %}
<script>
   
    var adjs = []
    function defAdder(parent){
        var button = document.createElement('option')
        button.value = '';
        button.selected = '';
        button.innerHTML = '---------';
        parent.append(button)
    }
    
    var addresses = []
    var branches = []
    replaces_names = {
        'btb_lc_check': ' BTB L/C',
        'pc_amount_check': ' PC Amount',
        'snd_amount_check': ' SND Amount',
        'term_loan_check': ' Term Loan',
        'time_load_check': ' Time Loan',
        'od_load_check': ' OD Loan',
        'edf_interest_check': ' EDF Interest',
        'buying_com_check': ' Buying Comm.',
        'tax_other_check': ' Source Tax & others',
        'additional_one_check': 'others',
     };
     
    
    function calc() {
        var eba = parseFloat(document.getElementById("bill_value").value, 10);

        var blp = parseFloat(document.getElementById("btb_lc_pct").value, 10);
        var pc_amt = parseFloat(document.getElementById("pc_amount_pct").value, 10);
        var snd_amt = parseFloat(document.getElementById("snd_amount_pct").value, 10);
        var term_amt = parseFloat(document.getElementById("term_loan_pct").value, 10);
        var time_amt = parseFloat(document.getElementById("time_loan_pct").value, 10);
        var od_amt = parseFloat(document.getElementById("od_loan_pct").value, 10);
        var edf_amt = parseFloat(document.getElementById("edf_interest_pct").value, 10);
        var buy_amt = parseFloat(document.getElementById("buying_com_pct").value, 10);
        var tax_amt = parseFloat(document.getElementById("tax_other_pct").value, 10);
        var additional_amt = parseFloat(document.getElementById("additional_one_pct").value, 10);

        document.getElementById("total_percentage").value = parseFloat(blp+pc_amt+snd_amt+term_amt+time_amt+od_amt+edf_amt+buy_amt+tax_amt+additional_amt);

        var btbamt = document.getElementById("btb_lc_amt").value = (eba * (blp / 100));
        var pcamt = document.getElementById("pc_amount_amt").value = (eba * (pc_amt / 100));
        var sndamt = document.getElementById("snd_amount_amt").value =(eba * (snd_amt / 100));
        var termamt = document.getElementById("term_loan_amt").value =(eba * (term_amt / 100));
        var timeamt = document.getElementById("time_loan_amt").value =(eba * (time_amt / 100));
        var odamt = document.getElementById("od_loan_amt").value =(eba * (od_amt / 100));
        var edfamt = document.getElementById("edf_interest_amt").value =(eba * (edf_amt / 100));
        var buyamt = document.getElementById("buying_com_amt").value =(eba * (buy_amt / 100));
        var taxamt = document.getElementById("tax_other_amt").value =(eba * (tax_amt / 100));
        var addamt = document.getElementById("additional_one_amt").value =(eba * (additional_amt / 100));

        var totalamount = document.getElementById("total_amount").value = parseFloat(btbamt+pcamt+sndamt+termamt+timeamt+odamt+edfamt+buyamt+taxamt+addamt);

        var namt = parseFloat(eba-totalamount);
        document.getElementById("net_amount").value = namt;
        var net_amt = parseFloat(document.getElementById("net_amount").value, 10);
        var ad_tpc = parseFloat(document.getElementById("ad_tpc").value, 10);
        var tpamt = parseFloat(net_amt + ad_tpc);
        var total_purc = document.getElementById("total_purchase").value = tpamt;
   }

   function adjustment(id){
    replaces_vars = {
    'btb_lc_check': 'btb_lc_amt',
    'pc_amount_check': 'pc_amount_amt',
    'snd_amount_check': 'snd_amount_amt',
    'term_loan_check': 'term_loan_amt',
    'time_load_check': 'time_loan_amt',
    'od_load_check': 'od_loan_amt',
    'edf_interest_check': 'edf_interest_amt',
    'buying_com_check': 'buying_com_amt',
    'tax_other_check': 'tax_other_amt',
    'additional_one_check': 'additional_one_amt'
    };
    var total = parseFloat(document.getElementById('ad_tpc').value, 10) 
    if (document.getElementById(id).checked) {
        document.getElementById('ad_tpc').value =  total + parseFloat(document.getElementById(replaces_vars[id]).value, 10)
        addName(id)
        adder()
    } else {
        document.getElementById('ad_tpc').value =  total - parseFloat(document.getElementById(replaces_vars[id]).value, 10)
        removeName(id)
        adder()
    }

}
    function addName(id){
        if (document.getElementById('checkout_names').value.length <= 5) {
            document.getElementById('checkout_names').value += replaces_names[id];
            adjs.push(replaces_names[id])
        } else {
            document.getElementById('checkout_names').value += ' +' + replaces_names[id];
            adjs.push(replaces_names[id])
        }
    };

    function removeName(id){
        if (adjs.includes(replaces_names[id])){
            for (var i = 0; i<adjs.length; i++){
                if(adjs[i]==replaces_names[id]){
                    adjs.splice(i, 1)
                }
            }
            document.getElementById('checkout_names').value = ''
            for (var i = 0;i<adjs.length;i++){
                if (document.getElementById('checkout_names').value.length <= 5){
                    document.getElementById('checkout_names').value += adjs[i]
                } else {
                    document.getElementById('checkout_names').value += ' +' + adjs[i];
                }
            }
        }
    };
    
    function adder(){
        document.getElementById('total_purchase').value = parseFloat(document.getElementById('ad_tpc').value) + parseFloat(document.getElementById('net_amount').value)
    };

    function fetcher() {
        const myNode = document.getElementById("id_bank_branch");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.lastChild);
        }
        defAdder(document.getElementById('id_bank_branch'))
        var branch = document.createElement('option');
        fetch('/api/erp/bank').then(res => res.json()).then(data =>
        branch.innerText = Object.keys(data[document.getElementById('id_bank_name').children[document.getElementById('id_bank_name').value].innerHTML])[0]
        )
        fetch('/api/erp/bank').then(res => res.json()).then(data =>
        branch.value = document.getElementById('id_bank_name').value
        )
        document.getElementById('id_bank_branch').append(branch);
        
    }

    function change(){
        const myNode = document.getElementById("id_bank_address");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.lastChild);
        }
        defAdder(document.getElementById('id_bank_address'))
    }

    function addressFetcher(){
        change();
        var address = document.createElement('option');
        var branch = document.getElementById('id_bank_branch');
        fetch('/api/erp/bank').then(res => res.json()).then(data => 
        address.innerHTML = data[document.getElementById('id_bank_name').children[document.getElementById('id_bank_name').value].innerHTML][branch.lastChild.innerText]
        )
        fetch('/api/erp/bank').then(res => res.json()).then(data => 
        address.value = document.getElementById('id_bank_name').value
        )
        document.getElementById('id_bank_address').append(address);

    }
    
     // FOR SHOWING THE TODAY DATE 
     var today = new Date();
     var dd = today.getDate();
     var mm = today.getMonth()+1; //January is 0!
     var yyyy = today.getFullYear();
     if(dd<10) {
         dd = '0'+dd
       } 
     if(mm<10) {
         mm = '0'+mm
       } 
     // today = yyyy + '/' + mm + '/' + dd;
     today = yyyy + '-' + mm + '-' + dd;
     console.log(today);
     document.getElementById('bank_p_date').value = today;

   </script>  

<script type="text/javascript"> 
    function demoShow(){ 
        if( $(window).load){

            document.getElementById("show").style.visibility="visible";
        };
       
        };
</script>
{% endblock script %}
